!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.Lines=e():t.Lines=e()}(window,(function(){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(r,o,function(e){return t[e]}.bind(null,o));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=3)}([function(t,e){function n(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if(!(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t)))return;var n=[],r=!0,o=!1,i=void 0;try{for(var a,l=t[Symbol.iterator]();!(r=(a=l.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(t){o=!0,i=t}finally{try{r||null==l.return||l.return()}finally{if(o)throw i}}return n}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function r(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function o(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?r(n,!0).forEach((function(e){i(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):r(n).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function i(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var a={},l={line:{},candle:{},ema:{},sma:{}},c=o({},l);a.save=function(t){arguments.length>1&&void 0!==arguments[1]&&arguments[1];var e=a.validate(t)?t:a.dataFormatter(t);a.mset({raw:e,labels:e.map((function(t){return t[4]})),data:e.map((function(t){return t[3]}))})},a.all=function(){return l},a.get=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"line";return l[e][t]},a.mget=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"line",n={};return t.forEach((function(t){n[t]=l[e][t]})),n},a.init=function(t){var e=n(t.split("."),2),r=e[0],o=e[1];return o?(!l[r]&&(l[r]={}),!l[r][o]&&(l[r][o]=[])):!l[r]&&(l[r]=[]),o?[r,o]:[r]},a.push=function(t,e){var n=a.init(t);n[1]?l[n[0]][n[1]].push(e):l[n[0]].push(e)},a.set=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"line";l[n][t]=e},a.mset=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"line";l[e]=o({},l[e],{},t)},a.validate=function(t){return t.every((function(t){return!t.date||!t.high}))},a.dataFormatter=function(t){return t.map((function(t){return[t.open,t.high,t.low,t.close,t.date]}))},a.reset=function(){l=o({},c)},t.exports=o({},a)},function(t,e){t.exports={config:{animate:!1,zoomMove:!0,chart:{type:["line","candle","sma","ema"],padding:30,attr:{stroke:"#ddd",fill:"none",strokeWidth:1},textAttr:{"stroke-width":"0.1px","font-family":"Verdana","font-size":"12px",fill:"#000"},textBold:{"font-weight":"bold"},enableGrid:!0,candleFill:.4,totalGrids:5,navDot:6,candleFields:{body:["x","y","width","height"],shadow:[]}},cssClass:{textLabel:"tlabel",liveLabel:"llabel",liveLine:"lline",liveDot:"ldot",winCandle:"wcandle",loseCandle:"lcandle",debugDot:"ddot",line:"stline",sma:"stsma",ema:"stema",grid:"staxis",navDot:"stnavdot",moveNavDot:"movedot",rotateNavDot:"rotatedot"},smaLength:5,emaLength:10,magnetMode:50,step:{x:50,xMin:20,xMax:100,yMax:20,arrow:50,zoom:9,offset:9,xLegend:100},debug:{radius:6,attr:{stroke:"red"}},timeUnit:"15m",timeUnits:["15m","30m","1h","4h","1d","1w"],drawOrder:["drawLine","drawCandle","drawSMA","drawEMA"]},SVG:{line:"line",text:"text",rect:"rect",circle:"circle",path:"path",input:"input"},PART:{axis:"axis",line:"line",candle:"candle",legend:"legend",debug:"debug",sinit:"sinit",init:"init",sma:"sma",ema:"ema"}}},function(t,e){function n(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function r(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}t.exports=function(t){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?n(o,!0).forEach((function(e){r(t,e,o[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):n(o).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))}))}return t}({},{f:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5;return Math.abs(parseFloat(t).toFixed(e))},fDate:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"15m",n=new Date(t);if("15m"===e)return n.getHours()+":"+n.getMinutes()},candle:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"body",n={body:["x","y","width","height","isWin"],shadow:["top","bottom","isWin"]};return Object.keys(t).filter((function(t){return n[e].includes(t)})).reduce((function(e,n){return e[n]=t[n],e}),{})}})},function(t,e,n){var r=n(0),o=n(4),i=n(5),a=n(1).PART;window.cl=console.log;var l=function(){var t=function(t){if(!window.Snap)throw new Error("Missing Snap.svg library !");this.calc=new o,this.chart=new i(t,this.calc)};return t.prototype.data=function(t){if(!(t instanceof Array))throw new Error("Missing library  data !");r.save(t),this.calc.start(),this.calc.main()},t.prototype.draw=function(t){switch(t){case a.axis:this.chart.drawAxis();break;case a.line:this.chart.drawLine();break;case a.candle:this.chart.drawCandle()}},t}();void 0!==t.exports?t.exports=l:window.Lines=l},function(t,e,n){function r(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function o(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function a(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function l(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var c=n(0),s=n(2),u=n(1).config,f=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,n,f;return e=t,(n=[{key:"start",value:function(){this.init(),this.initSteps()}},{key:"init",value:function(){var t=c.get("raw"),e=a(t[0]);e.pop();var n={len:t.length,min:Math.min.apply(Math,a(e)),max:Math.max.apply(Math,a(e)),amplitude:0,zero:e[3]};t.forEach((function(t){n.min>t[2]&&(n.min=t[2]),n.min>t[3]&&(n.min=t[3]),n.max<t[1]&&(n.max=t[1]),n.max<t[3]&&(n.max=t[3])})),n.amplitude=s.f(n.max-n.min),this.save(n)}},{key:"init2",value:function(){var t=c.get("data");console.log(c.all());var e={len:t.length,min:t[0],max:t[0],amplitude:0,zero:t[0]};t.forEach((function(t){e.min>t&&(e.min=t),e.max<t&&(e.max=t)})),e.amplitude=s.f(e.max-e.min),this.save(e)}},{key:"initSteps",value:function(){var t,e,n,r,o=c.mget(["area","amplitude","len","zero","min"]),i=o.area,a=o.amplitude,l=o.len,u=o.zero,f=o.min;t=s.f(i.width/l,0),e=s.f(i.height/a,0),n=i.zeroX,r=s.f(i.zeroY-(u-f)*e,0),this.save({stepX:t,stepY:e,zeroX:n,zeroY:r})}},{key:"main",value:function(){this.lines(),this.candle(),this.sma()}},{key:"lines",value:function(){var t=c.mget(["data","zeroX","zeroY","len"]),e=t.data,n=t.zeroX,r=t.zeroY,o=t.len,i=c.mget(["stepX","stepY"]),a=i.stepX,l=i.stepY;c.push("line.points",[n,r]),this.tmp={data:e,stepX:a,stepY:l,lastX:n,lastY:r};for(var s=1;s<o;s++)this.calcPoint(s)}},{key:"calcPoint",value:function(t){var e=this.tmp.data[t-1],n=this.tmp.data[t];n<e?this.point(e-n,"plus"):n>e?this.point(n-e,"minus"):this.point(0,"equal")}},{key:"point",value:function(t,e){var n,r=this.tmp.lastX+this.tmp.stepX,o=t*this.tmp.stepY;n=this.tmp.lastY,"plus"===e?n+=o:"minus"===e&&(n-=o),c.push("line.points",[s.f(r,0),s.f(n,0)]),this.tmp.lastX=r,this.tmp.lastY=n}},{key:"yAxis",value:function(){var t=c.mget(["amplitude","area","min"]),e=t.amplitude,n=t.area,r=t.min,o=u.chart.totalGrids,i=s.f(e*(1/o),7);return{xAxis:n.zeroX,yAxis:n.zeroY,label:r,labelDiff:i}}},{key:"save",value:function(t){arguments.length>1&&void 0!==arguments[1]&&arguments[1],"object"===i(t)&&c.mset(t)}},{key:"candle",value:function(){var t=this,e=c.mget(["points","stepX","stepY","raw"]),n=e.points,r=e.stepX,o=e.stepY,i=e.raw,a=u.chart.candleFill,l=s.f(r*a,0);n.forEach((function(e,a){if(a>0){var c={prevPoint:n[a-1],point:e};t.candleBody(c,{candleWidth:l,stepX:r,stepY:o,ohlc:{Open:i[a][0],High:i[a][1],Low:i[a][2],Close:i[a][3]}})}}))}},{key:"candleBody",value:function(t,e){var n=t.prevPoint,r=t.point,o=e.candleWidth,i=e.stepX,a={x:0,y:r[1]>n[1]?n[1]:r[1],width:o,height:Math.abs(r[1]-n[1]),xCenter:s.f(r[0]-i/2,0),isWin:n[1]>r[1]};a.x=s.f(a.xCenter-o/2,0),this.candleShadow(t,e,a)}},{key:"candleShadow",value:function(t,e,n){var i,a,l=t.prevPoint,u=t.point,f=e.stepY,p=e.ohlc,d=p.Open,h=p.High,y=p.Low,b=p.Close,v=n.y,m=n.xCenter,g=n.isWin,w={top:[[m,v],[m,v]],bottom:[[m,l[1]],[m,l[1]]],isWin:g};g?(i=h-b,a=d-y):(i=h-d,a=b-y,w.bottom[0][1]=u[1],w.bottom[1][1]=u[1]),w.top[1][1]-=s.f(i*f,0),w.bottom[1][1]+=s.f(a*f,0),c.push("candle.points",function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?r(n,!0).forEach((function(e){o(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):r(n).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({},n,{},w))}},{key:"sma",value:function(){console.log("start SMA ..."),console.log(c.all())}}])&&l(e.prototype,n),f&&l(e,f),t}();t.exports=f},function(t,e,n){function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function i(t,e){return!e||"object"!==r(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function a(t){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function l(t,e){return(l=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var c=n(0),s=n(2),u=(n(1),function(t){function e(t,n){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),i(this,a(e).call(this,t,n))}var n,r,u;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&l(t,e)}(e,t),n=e,(r=[{key:"drawCandle",value:function(){var t=this,e=this.getCandle();e.body.forEach((function(e){var n=e.isWin?"wcandle":"lcandle";delete e.isWin,t.svgRect(e,n)})),e.shadow.forEach((function(e){var n=t.getPath(e.top[0],e.top[1]);n+=t.getPath(e.bottom[0],e.bottom[1]),t.svgPath(n,e.isWin?"wcandle":"lcandle")}))}},{key:"getCandle",value:function(){var t=c.get("points","candle"),e={body:[],shadow:[]};return t.forEach((function(t){e.body.push(s.candle(t)),e.shadow.push(s.candle(t,"shadow"))})),e}}])&&o(n.prototype,r),u&&o(n,u),e}(n(6)));t.exports=u},function(t,e,n){function r(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function o(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var i=n(0),a=n(2),l=n(1).config,c=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),window.getComputedStyle&&(this.el=this.getId(e),this.snap=window.Snap("#"+e),this.calc=n,this.init())}var e,n,c;return e=t,(n=[{key:"init",value:function(){var t=window.getComputedStyle(this.el),e=a.f(t.width,0),n=a.f(t.height,0),r=n-2*l.chart.padding;this.area={w:e,h:n,width:e-2*l.chart.padding,height:r,endX:e-l.chart.padding,zeroX:l.chart.padding,zeroY:n-l.chart.padding,offsetLeft:this.el.offsetLeft||this.el.parentElement.offsetLeft||0,offsetTop:this.el.offsetTop||this.el.parentElement.offsetTop||0,gridStep:a.f(r/l.chart.totalGrids,0)},i.set("area",this.area)}},{key:"drawAxis",value:function(){this.drawLabelsX(),this.drawLabelsY()}},{key:"drawLabelsX",value:function(){var t=this,e=i.mget(["labels","points"]),n=e.labels,r=e.points,o=Math.floor(this.area.zeroY+l.chart.padding/2);n.forEach((function(e,n){var i=r[n][0],l=a.fDate(e);t.svgText({xAxis:i,yAxis:o,label:l})}))}},{key:"drawLabelsY",value:function(){var t=this,e=l.chart,n=e.enableGrid,o=e.totalGrids,i=this.area,c=i.endX,s=i.gridStep,u=this.calc.yAxis(),f=u.xAxis,p=u.yAxis,d=u.label,h=u.labelDiff,y="";r(Array(o+1)).forEach((function(){t.svgText({xAxis:f,yAxis:p,label:d}),n&&(y+=t.getPath([f,p],[c,p])),p-=s,d=a.f(d+h,5)})),n&&this.svgPath(y,l.cssClass.grid)}},{key:"drawLine",value:function(){for(var t=i.mget(["points","len"]),e=t.points,n=0,r="",o=t.len-1;n<o;n++)r+=this.getPath(e[n],e[n+1]),this.svgDebug(e[n]);this.svgPath(r)}},{key:"getPath",value:function(t,e){var n="M".concat(Math.floor(t[0])," ").concat(Math.floor(t[1]));return n+="L".concat(Math.floor(e[0])," ").concat(Math.floor(e[1]))}},{key:"svgDebug",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.snap.circle({cx:t[0],cy:t[1],r:3})}},{key:"svgRect",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.snap.rect(t);e&&n.attr({class:e})}},{key:"svgText",value:function(t){var e=t.xAxis,n=t.yAxis,r=t.label;this.snap.text(e-5,n,r)}},{key:"svgPath",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"stline";this.snap.path(t).attr({class:e})}},{key:"getId",value:function(t){return document.getElementById(t)}}])&&o(e.prototype,n),c&&o(e,c),t}();t.exports=c}])}));